LOCALES = {
    "ru": {
        "cmd_start": "Добро пожаловать в OrbitVPN! Выберите опцию:",
        "change_language": "Язык",
        "buy_subscription": "Купить подписку",
        "no_configs": "У вас ещё нет VPN конфигураций.",
        "your_configs": "Ваши VPN конфигурации:",
        "config_created": "Конфигурация создана. Ваши VPN конфигурации:",
        'your_config': 'Ваша подписка:',
        "config_selected": "Нажмите чтобы скопировать:",
        "config_deleted": "Конфигурация удалена",
        "balance_text": "Ваш баланс: {balance} RUB",
        "welcome": "Добро пожаловать в OrbitVPN! Выберите опцию:",
        "settings_text": "Ваши настройки:",
        "choose_language": "Выберите язык:",
        "language_updated": "Язык обновлён.",
        "under_development": "Это в разработке",
        "balance": "Баланс",
        "my_vpn": "Мой VPN",
        "help": "Помощь",
        "settings": "Настройки",
        "low_balance": "Недостаточно средств.",
        "add_funds": "Пополнить баланс",
        "transaction_history": "История транзакций",
        "referral": "Реферал",
        "error_creating_config": "Ошибка при создании конфигурации. Попробуйте позже или свяжитесь с поддержкой.",
        "add_config": "Добавить конфигурацию",
        "back_main": "В главное меню",
        "back": "Назад",
        "delete_config": "Удалить",
        "error_creating_payment": "Ошибка при создании платежа. Попробуйте позже.",
        "top_up_text": "Ссылка для пополнения {amount} RUB: {payment_url}",
        "link_not_found": "(Ссылка не найдена)",
        "creating_config": "Создаём конфигурацию...",
        "instruction": "Установка",
        "instruction_text": (
            "Установка VLESS-конфига:\n\n"
            "1. Скачайте клиент V2RayTun (или аналог) для вашей платформы.\n"
            "2. Откройте приложение и найдите кнопку импорта конфигурации.\n"
            "3. Вставьте ссылку VLESS, которую прислал бот.\n"
            "4. Сохраните конфигурацию и включите соединение."
        ),
        "max_configs_reached": "Достигнут максимум конфигураций (1). Удалите старую.",
        "no_servers": "Нет доступных серверов. Свяжитесь с поддержкой.",
        "buy_sub_text": "Выберите подписку:",
        "sub_1m": "1 месяц - {price} RUB",
        "sub_3m": "3 месяца - {price} RUB",
        "sub_6m": "6 месяцев - {price} RUB",
        "sub_12m": "12 месяцев - {price} RUB",
        "sub_success": "Подписка куплена! Конфигурация создана.",
        "payment_method": "Выберите способ оплаты:",
        "pm_yookassa": "YooKassa (карта/RUB)",
        "pm_cryptobot": "CryptoBot (крипта)",
        "pm_stars": "Telegram Stars",
        "enter_amount": "Введите сумму пополнения (RUB, минимум 200):",
        "invalid_amount": "Неверная сумма. Введите число >=200.",
        "payment_created": "Оплатите {amount} Stars для пополнения {amount} RUB.",
        'renew_config': 'Продлить',
        'config_expired': 'Истёк',
        'config_active': 'Активно',
        "free_trial_created": "Пробная подписка на 7 дней активирована.",
        "referral_text": "Пригласите друга — каждый получит 50 RUB.\n\nВаша реферальная ссылка:\n{ref_link}",
        "sub_renewed_auto": "Подписка продлена автоматически.",
        "sub_expired_low_balance": "Подписка истекла (недостаточно средств для авто-продления).",
        "sub_renewed": "Подписка продлена.",
        'buy_sub': 'Купить подписку',
        "no_active_subscription": "У вас нет активной подписки. Купите подписку, чтобы создать конфигурацию.",
        "subscription_expired": "Ваша подписка истекла. Продлите подписку, чтобы продолжить использование VPN.",
        "config_created": "Конфигурация создана успешно!",
        "your_configs_with_sub": "Ваша подписка:\n\nАктивна до: {expire_date}",
        "no_configs_has_sub": "У вас нет конфигураций\n\nПодписка активна до: {expire_date}\n\nНажмите 'Добавить конфигурацию' чтобы создать.",
        "subscription_active_until": "Подписка активна до: {expire_date}",
        "subscription_expired_on": "Подписка истекла: {expire_date}",
        "no_subscription": "Нет активной подписки",
        "sub_purchased": "Подписка успешно приобретена!",
        "sub_purchased_create_config": "Подписка куплена! Создайте конфигурацию.",
        "create_first_config": "Подписка активирована!\n\nТеперь создайте свою первую конфигурацию VPN:",
        "error_buying_sub": "Ошибка при покупке подписки",
        "sub_success_with_expire": "Подписка активна до: {expire_date}",
        "extend_subscription": "Выберите срок продления:",
        "current_sub_until": "Текущая подписка действует до: {expire_date}",
        "add_config": "Добавить конфигурацию",
        'share': 'Поделиться',
        "too_fast": "Вы отправляете слишком много запросов",
        'top_up_text_ton': "Пополнить {amount} RUB\nОтправьте {ton_amount:.6f} TON на кошелек:\n{wallet}",
        'extend': 'Продлить',
        'ton_payment_instruction': (
                "Оплата через TON\n\n"
                "Отправьте {ton_amount} на кошелек:\n"
                "{wallet}\n\n"
                "Комментарий: {comment}\n\n"
                "Без комментария платёж не будет засчитан."    
        ),
        'stars_add_title': 'Пополнение баланса',
        'stars_add_description': 'Пополните баланс на {amount} RUB'
    },
    "en": {
        "cmd_start": "Welcome to OrbitVPN! Choose an option:",
        "change_language": "Language",
        "buy_subscription": "Buy subscription",
        "no_configs": "You don't have any VPN configs yet.",
        "your_configs": "Your VPN configs:",
        "config_created": "Config created. Your VPN configs:",
        'your_config': 'Your config:',
        "config_selected": "Click to copy:",
        "config_deleted": "Config deleted",
        "balance_text": "Your balance is {balance} RUB",
        "welcome": "Welcome to OrbitVPN! Choose an option:",
        "settings_text": "Your settings:",
        "choose_language": "Choose your language:",
        "language_updated": "Language updated.",
        "under_development": "It's currently under development",
        "balance": "Balance",
        "my_vpn": "My VPN",
        "help": "Help",
        "settings": "Settings",
        "low_balance": "Not enough funds.",
        "add_funds": "Add Funds",
        "transaction_history": "Transaction History",
        "referral": "Referral",
        "error_creating_config": "Error creating config. Try later or contact support.",
        "add_config": "Add Config",
        "back_main": "Back to main",
        "back": "Back",
        "delete_config": "Delete",
        "error_creating_payment": "Error creating payment. Try later.",
        "top_up_text": "Click to top up {amount} RUB: {payment_url}",
        "link_not_found": "(Link not found)",
        "creating_config": "Creating config...",
        "instruction": "Installation",
        "instruction_text": (
            "VLESS configuration installation:\n\n"
            "1. Download V2RayTun client (or similar) for your platform.\n"
            "2. Open the app and find the import configuration button.\n"
            "3. Paste the VLESS link provided by the bot.\n"
            "4. Save the configuration and enable the connection."
        ),
        "max_configs_reached": "Max configs reached (1). Delete old one.",
        "no_servers": "No servers available. Contact support.",
        "buy_sub_text": "Choose subscription:",
        "sub_1m": "1 month - 190 RUB",
        "sub_3m": "3 months - 540 RUB",
        "sub_6m": "6 months - 990 RUB",
        "sub_12m": "12 months - 1890 RUB",
        "sub_success": "Subscription bought! Config created.",
        "payment_method": "Choose payment method:",
        "pm_yookassa": "YooKassa (card/RUB)",
        "pm_cryptobot": "CryptoBot (crypto)",
        "pm_stars": "Telegram Stars",
        "enter_amount": "Enter top-up amount (RUB, min 200):",
        "invalid_amount": "Invalid amount. Enter number >=200.",
        "payment_created": "Pay {amount} Stars to top up {amount} RUB.",
        'renew_config': 'Renew',
        'config_expired': 'Expired',
        'config_active': 'Active',
        "free_trial_created": "You got a free 7-day trial subscription.",
        "referral_text": "Invite a friend — each of you get 50 RUB.\n\nYour referral link:\n{ref_link}",
        "sub_renewed_auto": "Subscription renewed automatically.",
        "sub_expired_low_balance": "Subscription expired (low balance for auto-renew).",
        "sub_renewed": "Subscription renewed.",
        'buy_sub': 'Subscribe',
        "no_active_subscription": "You don't have an active subscription. Buy a subscription to create a configuration.",
        "subscription_expired": "Your subscription has expired. Renew your subscription to continue using VPN.",
        "config_created": "Configuration created successfully!",
        "your_configs_with_sub": "Your subscription:\n\nActive until: {expire_date}",
        "no_configs_has_sub": "You have no configurations\n\nSubscription active until: {expire_date}\n\nPress 'Add Configuration' to create one.",
        "subscription_active_until": "Subscription active until: {expire_date}",
        "subscription_expired_on": "Subscription expired: {expire_date}",
        "no_subscription": "No active subscription",
        "sub_purchased": "Subscription purchased successfully!",
        "sub_purchased_create_config": "Subscription purchased! Create a configuration.",
        "create_first_config": "Subscription activated!\n\nNow create your first VPN configuration:",
        "error_buying_sub": "Error purchasing subscription",
        "sub_success_with_expire": "Subscription active until: {expire_date}",
        "extend_subscription": "Select the duration:",
        "current_sub_until": "Current subscription valid until: {expire_date}",
        "add_config": "Add configuration",
        'share': 'Share',
        "too_fast": "You're sending too many requests",
        'top_up_text_ton': "Top up {amount} RUB\nSend {ton_amount:.6f} TON to wallet:\n{wallet}",
        'extend': 'Extend',
        'ton_payment_instruction': (
                "Payment via TON\n\n"
                "Send {ton_amount} to the wallet:\n"
                "{wallet}\n\n"
                "Comment: {comment}\n\n"
                "Payment without the comment will not be credited."
        ),
        'stars_add_title': 'Add funds to balance',
        'stars_add_description': 'Add {amount} RUB to your balance'
    }
}


def t(lang: str, key: str, **kwargs):
    lang_dict = LOCALES.get(lang, LOCALES["en"])
    text = lang_dict.get(key, key)
    try:
        return text.format(**kwargs)
    except Exception:
        return text


def get_translator(lang: str):
    lang_dict = LOCALES.get(lang, LOCALES["en"])

    def translate(key: str, **kwargs):
        text = lang_dict.get(key, key)
        try:
            return text.format(**kwargs)
        except Exception:
            return text

    return translate